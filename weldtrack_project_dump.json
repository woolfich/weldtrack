{
  "project_name": "weldtrack",
  "root_path": "/home/evgen/–î–æ–∫—É–º–µ–Ω—Ç—ã/weldtrack",
  "total_files": 21,
  "files": [
    {
      "path": "postcss.config.js",
      "size": 81,
      "content": "export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};\n"
    },
    {
      "path": "svelte.config.js",
      "size": 426,
      "content": "import adapter from '@sveltejs/adapter-static';\nimport { vitePreprocess } from '@sveltejs/vite-plugin-svelte';\n\n/** @type {import('@sveltejs/kit').Config} */\nconst config = {\n  preprocess: vitePreprocess(),\n  kit: {\n    adapter: adapter({\n      pages: 'build',\n      assets: 'build',\n      fallback: 'index.html',  // –í–∞–∂–Ω–æ –¥–ª—è SPA-—Ä–æ—É—Ç–∏–Ω–≥–∞!\n      precompress: false,\n      strict: true\n    }),\n  },\n};\n\nexport default config;"
    },
    {
      "path": "vite.config.ts",
      "size": 1190,
      "content": "import { sveltekit } from '@sveltejs/kit/vite';\nimport { SvelteKitPWA } from '@vite-pwa/sveltekit';\nimport { defineConfig } from 'vite';\n\nexport default defineConfig({\n  plugins: [\n    sveltekit(),\n    SvelteKitPWA({\n      registerType: 'autoUpdate',\n      manifest: {\n        name: 'WeldTrack',\n        short_name: 'WeldTrack',\n        description: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å–≤–∞—Ä—â–∏–∫–æ–≤',\n        theme_color: '#1e293b',\n        background_color: '#0f172a',\n        display: 'standalone',\n        orientation: 'portrait',\n        start_url: '/',\n        icons: [\n          {\n            src: '/icons/icon-192x192.png',\n            sizes: '192x192',\n            type: 'image/png',\n            // –£–±—Ä–∞–ª purpose: 'any maskable' ‚Äî –æ—Å—Ç–∞–≤—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–∫–æ–Ω–∫–∏ —Ä–µ–∞–ª—å–Ω–æ maskable\n          },\n          {\n            src: '/icons/icon-512x512.png',\n            sizes: '512x512',\n            type: 'image/png',\n          },\n        ],\n      },\n      workbox: {\n        // –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ–µ–∫—Ç–µ\n        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],\n      },\n      // –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å PWA –ª–æ–∫–∞–ª—å–Ω–æ\n      devOptions: {\n        enabled: true,\n      },\n    }),\n  ],\n});"
    },
    {
      "path": "tsconfig.json",
      "size": 414,
      "content": "{\n  \"extends\": \"./.svelte-kit/tsconfig.json\",\n  \"compilerOptions\": {\n    \"allowJs\": true,\n    \"checkJs\": true,\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"resolveJsonModule\": true,\n    \"skipLibCheck\": true,\n    \"sourceMap\": true,\n    \"strict\": true,\n    \"moduleResolution\": \"bundler\",\n    \"module\": \"ESNext\",\n    \"target\": \"ESNext\"\n  },\n  \"include\": [\"src/**/*\", \"tests/**/*\"]\n}"
    },
    {
      "path": "README.md",
      "size": 1478,
      "content": "# WeldTrack ‚Äî PWA –¥–ª—è —É—á—ë—Ç–∞ —Ä–∞–±–æ—Ç —Å–≤–∞—Ä—â–∏–∫–æ–≤\n\n## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫\n\n```bash\nnpm install\nnpm run dev\n```\n\n## –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞\n\n```bash\nnpm run build\nnpm run preview\n```\n\n## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\n```\nsrc/\n  lib/\n    types.ts          ‚Äî TypeScript-—Ç–∏–ø—ã (Rate, PlanItem, WCEntry, Welder)\n    utils.ts          ‚Äî —É—Ç–∏–ª–∏—Ç—ã (normalizeArticle, formatQty, calcOvertime, recalcPlanCompleted)\n    stores.ts         ‚Äî Svelte stores —Å persistence –≤ localStorage\n    components/\n      BottomNav.svelte ‚Äî –Ω–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è\n  routes/\n    +layout.svelte    ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π –ª—ç–π–∞—É—Ç\n    +page.svelte      ‚Äî –ì–ª–∞–≤–Ω–∞—è (—Å–ø–∏—Å–æ–∫ —Å–≤–∞—Ä—â–∏–∫–æ–≤)\n    rates/\n      +page.svelte    ‚Äî –ù–æ—Ä–º—ã\n    plan/\n      +page.svelte    ‚Äî –ü–ª–∞–Ω\n    wc/[id]/\n      +page.svelte    ‚Äî –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–≤–∞—Ä—â–∏–∫–∞ (WC)\n```\n\n## –ò–∫–æ–Ω–∫–∏ PWA\n\n–ü–æ–º–µ—Å—Ç–∏—Ç–µ –∏–∫–æ–Ω–∫–∏ –≤ `static/icons/`:\n- `icon-192x192.png`\n- `icon-512x512.png`\n\n## –°—Ç–µ–∫\n\n- **SvelteKit** + TypeScript\n- **TailwindCSS** –¥–ª—è —Å—Ç–∏–ª–µ–π\n- **@vite-pwa/sveltekit** –¥–ª—è PWA / service worker\n- **localStorage** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –±—ç–∫–µ–Ω–¥–∞)\n- **uuid** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID\n\n## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞\n\n- –ê—Ä—Ç–∏–∫—É–ª—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è: `\"xt 44\"` ‚Üí `\"XT44\"`\n- –ß–∏—Å–ª–∞ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å 2 –∑–Ω–∞–∫–∞–º–∏: `1.30`, `0.40`\n- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ = —Å—É–º–º–∞ (–Ω–æ—Ä–º–∞ √ó –∫–æ–ª-–≤–æ) –∑–∞ –¥–µ–Ω—å ‚àí 8 —á–∞—Å–æ–≤\n- –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–π –¥–∞—Ç—ã\n- –ü–ª–∞–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (locked) –ø—Ä–∏ `completed >= target`\n- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã –Ω–µ–ª—å–∑—è –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫—É\n- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–≤–æ–¥ –æ–¥–Ω–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å —Å—É–º–º–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ\n"
    },
    {
      "path": "tailwind.config.js",
      "size": 242,
      "content": "/** @type {import('tailwindcss').Config} */\nexport default {\n  content: ['./src/**/*.{html,js,svelte,ts}'],\n  theme: {\n    extend: {\n      colors: {\n        slate: {\n          950: '#020617',\n        },\n      },\n    },\n  },\n  plugins: [],\n};\n"
    },
    {
      "path": "vercel.json",
      "size": 32,
      "content": "{\n  \"outputDirectory\": \"build\"\n}"
    },
    {
      "path": "package.json",
      "size": 859,
      "content": "{\n  \"name\": \"weldtrack\",\n  \"version\": \"0.0.1\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"vite dev\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\",\n    \"check\": \"svelte-kit sync && svelte-check --tsconfig ./tsconfig.json\",\n    \"check:watch\": \"svelte-kit sync && svelte-check --tsconfig ./tsconfig.json --watch\"\n  },\n  \"devDependencies\": {\n    \"@sveltejs/adapter-static\": \"^2.0.3\",\n    \"@sveltejs/kit\": \"^1.30.4\",\n    \"@sveltejs/vite-plugin-svelte\": \"^2.5.3\",\n    \"@types/uuid\": \"^10.0.0\",\n    \"@vite-pwa/sveltekit\": \"^0.2.10\",\n    \"autoprefixer\": \"^10.4.17\",\n    \"postcss\": \"^8.4.35\",\n    \"svelte\": \"^4.2.12\",\n    \"svelte-check\": \"^3.6.6\",\n    \"tailwindcss\": \"^3.4.1\",\n    \"tslib\": \"^2.6.2\",\n    \"typescript\": \"^5.3.3\",\n    \"vite\": \"^4.5.2\",\n    \"workbox-window\": \"^7.0.0\"\n  },\n  \"dependencies\": {\n    \"uuid\": \"^9.0.1\"\n  },\n  \"type\": \"module\"\n}\n"
    },
    {
      "path": "src/app.html",
      "size": 636,
      "content": "<!doctype html>\n<html lang=\"ru\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <link rel=\"icon\" href=\"%sveltekit.assets%/favicon.png\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, viewport-fit=cover\" />\n    <meta name=\"theme-color\" content=\"#1e293b\" />\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n    <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" />\n    <link rel=\"manifest\" href=\"/manifest.webmanifest\" />\n    %sveltekit.head%\n  </head>\n  <body data-sveltekit-preload-data=\"hover\">\n    <div style=\"display: contents\">%sveltekit.body%</div>\n  </body>\n</html>\n"
    },
    {
      "path": "src/app.css",
      "size": 3174,
      "content": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  color-scheme: dark;\n}\n\n*, *::before, *::after {\n  box-sizing: border-box;\n}\n\nhtml, body {\n  margin: 0;\n  padding: 0;\n  background: #0f172a;\n  color: #e2e8f0;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  -webkit-tap-highlight-color: transparent;\n  overscroll-behavior: none;\n}\n\n.page-container {\n  display: flex;\n  flex-direction: column;\n  height: 100dvh;\n  height: 100vh;\n  overflow: hidden;\n  padding-top: env(safe-area-inset-top);\n}\n\n.top-panel {\n  flex-shrink: 0;\n  background: #1e293b;\n  border-bottom: 1px solid #334155;\n  padding: 10px 12px;\n  z-index: 10;\n}\n\n.scroll-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px 12px;\n  padding-bottom: calc(56px + env(safe-area-inset-bottom) + 8px);\n  -webkit-overflow-scrolling: touch;\n}\n\ninput[type=\"text\"],\ninput[type=\"number\"] {\n  min-height: 44px;\n  background: #0f172a;\n  border: 1px solid #334155;\n  border-radius: 8px;\n  color: #e2e8f0;\n  padding: 0 12px;\n  font-size: 16px;\n  outline: none;\n  width: 100%;\n}\n\ninput[type=\"text\"]:focus,\ninput[type=\"number\"]:focus {\n  border-color: #38bdf8;\n}\n\nbutton {\n  min-height: 44px;\n  border-radius: 8px;\n  border: none;\n  cursor: pointer;\n  font-size: 15px;\n  font-weight: 600;\n  transition: opacity 0.15s;\n}\n\nbutton:active {\n  opacity: 0.75;\n}\n\n.btn-primary {\n  background: #0ea5e9;\n  color: #fff;\n  padding: 0 16px;\n}\n\n.btn-secondary {\n  background: #334155;\n  color: #e2e8f0;\n  padding: 0 14px;\n}\n\n.btn-danger {\n  background: #ef4444;\n  color: #fff;\n  padding: 0 14px;\n}\n\n/* Modal overlay */\n.modal-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,0.65);\n  z-index: 200;\n  display: flex;\n  align-items: flex-end;\n  animation: fadeIn 0.15s ease;\n}\n\n.modal-sheet {\n  background: #1e293b;\n  border-radius: 16px 16px 0 0;\n  width: 100%;\n  padding: 20px 16px;\n  padding-bottom: calc(20px + env(safe-area-inset-bottom));\n  animation: slideUp 0.2s ease;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes slideUp {\n  from { transform: translateY(100%); }\n  to { transform: translateY(0); }\n}\n\n/* List items */\n.list-item {\n  display: flex;\n  align-items: center;\n  background: #1e293b;\n  border-radius: 10px;\n  padding: 12px 14px;\n  margin-bottom: 8px;\n  user-select: none;\n  -webkit-user-select: none;\n  cursor: pointer;\n  transition: background 0.1s;\n}\n\n.list-item:active {\n  background: #253047;\n}\n\n/* Suggestion dropdown */\n.suggestions {\n  position: absolute;\n  background: #1e293b;\n  border: 1px solid #334155;\n  border-radius: 8px;\n  z-index: 50;\n  max-height: 200px;\n  overflow-y: auto;\n  width: 100%;\n  box-shadow: 0 8px 24px rgba(0,0,0,0.4);\n}\n\n.suggestion-item {\n  padding: 12px 14px;\n  cursor: pointer;\n  font-size: 15px;\n}\n\n.suggestion-item:active,\n.suggestion-item:hover {\n  background: #253047;\n}\n\n/* Empty state */\n.empty-state {\n  text-align: center;\n  color: #64748b;\n  padding: 40px 20px;\n  font-size: 15px;\n}\n\n/* Scrollbar styling */\n::-webkit-scrollbar {\n  width: 4px;\n}\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n::-webkit-scrollbar-thumb {\n  background: #334155;\n  border-radius: 2px;\n}\n"
    },
    {
      "path": "src/lib/utils.ts",
      "size": 3893,
      "content": "import type { WCEntry, Rate, PlanItem, Welder } from './types';\n\nexport function normalizeArticle(input: string): string {\n  return input.replace(/\\s+/g, '').toUpperCase();\n}\n\nexport function formatQty(n: number): string {\n  return n.toFixed(2);\n}\n\nexport function todayISO(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\nexport function calcDayHours(entries: WCEntry[], rates: Rate[], date: string): number {\n  const dayEntries = entries.filter((e) => e.date === date);\n  let totalHours = 0;\n  for (const entry of dayEntries) {\n    const rate = rates.find((r) => r.article === entry.article);\n    if (rate) {\n      totalHours += rate.norm * entry.quantity;\n    }\n  }\n  return totalHours;\n}\n\nexport function calcOvertime(entries: WCEntry[], rates: Rate[], date: string): number {\n  const totalHours = calcDayHours(entries, rates, date);\n  return Math.max(0, totalHours - 8);\n}\n\nexport function calcDayStats(\n  entries: WCEntry[],\n  rates: Rate[],\n  overtimeByDate: Record<string, number>,\n  sortedDates: string[]\n): Map<string, { normalHours: number; overtimeHours: number }> {\n  const result = new Map<string, { normalHours: number; overtimeHours: number }>();\n  let pool = 0;\n\n  for (const date of sortedDates) {\n    const raw = calcDayHours(entries, rates, date);\n    const savedOvertime = overtimeByDate[date] ?? Math.max(0, raw - 8);\n\n    if (raw >= 8) {\n      pool += savedOvertime;\n      result.set(date, { normalHours: 8, overtimeHours: savedOvertime });\n    } else {\n      const deficit = 8 - raw;\n      const fromPool = Math.min(pool, deficit);\n      pool -= fromPool;\n      result.set(date, { normalHours: raw + fromPool, overtimeHours: 0 });\n    }\n  }\n\n  return result;\n}\n\n// --- –§–ò–ù–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ó–î–ï–õ–ï–ù–ò–Ø –ü–õ–ê–ù–û–í ---\nexport function recalcPlanCompleted(planItems: PlanItem[], allWelders: Welder[]): PlanItem[] {\n  const today = todayISO();\n\n  // –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º \"–∑–∞–∫—Ä—ã—Ç—ã–µ\" –ø–µ—Ä–∏–æ–¥—ã, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –ø–ª–∞–Ω—ã –Ω–µ –ª–µ–∑–ª–∏ –≤ –Ω–∏—Ö\n  // –°—Ç—Ä—É–∫—Ç—É—Ä–∞: Map<–ê—Ä—Ç–∏–∫—É–ª, –ú–∞—Å—Å–∏–≤–î–∞—Ç–ó–∞–∫—Ä—ã—Ç–∏—è>\n  const lockedDates = new Map<string, string[]>();\n  planItems.forEach(p => {\n    if (p.locked && p.completedDate) {\n      if (!lockedDates.has(p.article)) lockedDates.set(p.article, []);\n      lockedDates.get(p.article)!.push(p.completedDate);\n    }\n  });\n\n  return planItems.map((item) => {\n    \n    // 1. –ï—Å–ª–∏ –ø–ª–∞–Ω –£–ñ–ï –ó–ê–ö–†–´–¢ ‚Äî –º—ã –µ–≥–æ –ù–ï –ü–ï–†–ï–°–ß–ò–¢–´–í–ê–ï–ú.\n    // –ò—Å—Ç–æ—Ä–∏—è –Ω–µ–∏–∑–º–µ–Ω–Ω–∞. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É \"—Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è\".\n    if (item.locked) {\n      return item;\n    }\n\n    let completed = 0;\n    const periodEnd = today; // –î–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —Å—á–∏—Ç–∞–µ–º –ø–æ —Å–µ–≥–æ–¥–Ω—è\n\n    // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–∞—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –∞—Ä—Ç–∏–∫—É–ª–∞ (–∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø–ª–∞–Ω–æ–≤)\n    const articleLockedDates = lockedDates.get(item.article) || [];\n\n    for (const welder of allWelders) {\n      for (const entry of welder.entries) {\n        if (entry.article !== item.article) continue;\n        \n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–ø–∏—Å—å –≤—Ö–æ–¥–∏—Ç –≤ –æ–∫–Ω–æ [startDate, —Å–µ–≥–æ–¥–Ω—è]\n        if (entry.date >= item.startDate && entry.date <= periodEnd) {\n          \n          // 2. –ì–õ–ê–í–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê:\n          // –ï—Å–ª–∏ —ç—Ç–∞ –∑–∞–ø–∏—Å—å —Å–¥–µ–ª–∞–Ω–∞ –≤ –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –î–†–£–ì–û–ô –ø–ª–∞–Ω —É–∂–µ –∑–∞–∫—Ä—ã–ª—Å—è ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.\n          // (–ù–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ä—ã–π –ø–ª–∞–Ω –∑–∞–∫—Ä—ã—Ç 25-–≥–æ —á–∏—Å–ª–∞. –ó–∞–ø–∏—Å—å 25-–≥–æ —á–∏—Å–ª–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Å—Ç–∞—Ä–æ–º—É –ø–ª–∞–Ω—É.)\n          const isClaimedByLockedPlan = articleLockedDates.some(lockDate => entry.date <= lockDate);\n          \n          if (isClaimedByLockedPlan) {\n            continue;\n          }\n\n          completed += entry.quantity;\n        }\n      }\n    }\n\n    const locked = completed >= item.target;\n    return {\n      ...item,\n      completed,\n      locked,\n      // –ï—Å–ª–∏ –Ω–∞–±—Ä–∞–ª–∏ –Ω–æ—Ä–º—É, —Å—Ç–∞–≤–∏–º –¥–∞—Ç—É –∑–∞–∫—Ä—ã—Ç–∏—è\n      completedDate: locked ? (item.completedDate ?? today) : null,\n    };\n  });\n}\n\nexport function capitalizeFirst(str: string): string {\n  const trimmed = str.trim();\n  if (!trimmed) return trimmed;\n  return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);\n}"
    },
    {
      "path": "src/lib/types.ts",
      "size": 527,
      "content": "export type Rate = {\n  id: string;\n  article: string;\n  norm: number;\n};\n\nexport type PlanItem = {\n  id: string;\n  article: string;\n  target: number;\n  completed: number;\n  locked: boolean;\n  startDate: string;\n  completedDate?: string | null;\n};\n\nexport type WCEntry = {\n  id: string;\n  article: string;\n  quantity: number;\n  date: string;\n  updatedAt: number;\n};\n\nexport type Welder = {\n  id: string;\n  lastName: string;\n  entries: WCEntry[];\n  overtime: Record<string, number>;\n  overtimeManual: Record<string, boolean>;\n};\n"
    },
    {
      "path": "src/lib/stores.ts",
      "size": 3502,
      "content": "import { writable, get } from 'svelte/store';\nimport type { Writable } from 'svelte/store';\nimport type { Welder, Rate, PlanItem } from './types';\nimport { recalcPlanCompleted } from './utils';\n\nfunction createPersistedStore<T>(key: string, initial: T): Writable<T> {\n  let stored: T = initial;\n  if (typeof window !== 'undefined' && typeof localStorage !== 'undefined') {\n    const raw = localStorage.getItem(key);\n    if (raw) {\n      try {\n        stored = JSON.parse(raw) as T;\n      } catch {\n        stored = initial;\n      }\n    }\n  }\n\n  const store = writable<T>(stored);\n\n  store.subscribe((value) => {\n    if (typeof window !== 'undefined' && typeof localStorage !== 'undefined') {\n      localStorage.setItem(key, JSON.stringify(value));\n    }\n  });\n\n  return store;\n}\n\nexport const welders = createPersistedStore<Welder[]>('weldtrack_welders', []);\nexport const rates = createPersistedStore<Rate[]>('weldtrack_rates', []);\nexport const planItems = createPersistedStore<PlanItem[]>('weldtrack_plan', []);\n\n// Cross-store reactivity: when welders change, recalc plan completed\nwelders.subscribe((w) => {\n  const plan = get(planItems);\n  if (plan.length > 0) {\n    const updated = recalcPlanCompleted(plan, w);\n    // Only update if something changed to avoid infinite loop\n    const changed = updated.some(\n      (item, i) => item.completed !== plan[i].completed || item.locked !== plan[i].locked\n    );\n    if (changed) {\n      planItems.set(updated);\n    }\n  }\n});\n\nexport function exportData(): string {\n  const data = {\n    welders: get(welders),\n    rates: get(rates),\n    planItems: get(planItems),\n    exportedAt: new Date().toISOString(),\n  };\n  return JSON.stringify(data, null, 2);\n}\n\nexport function importData(json: string): void {\n  const data = JSON.parse(json);\n\n  if (data.rates && Array.isArray(data.rates)) {\n    const existingRates = get(rates);\n    const newRates = data.rates.filter(\n      (r: Rate) => !existingRates.some((er) => er.article === r.article)\n    );\n    rates.update((existing) => [...existing, ...newRates]);\n  }\n\n  if (data.planItems && Array.isArray(data.planItems)) {\n    const existingPlan = get(planItems);\n    const newPlan = data.planItems.filter(\n      (p: PlanItem) => !existingPlan.some((ep) => ep.article === p.article && ep.startDate === p.startDate)\n    );\n    planItems.update((existing) => [...existing, ...newPlan]);\n  }\n\n  if (data.welders && Array.isArray(data.welders)) {\n    welders.update((existing) => {\n      const result = [...existing];\n      for (const imported of data.welders as Welder[]) {\n        const existingIdx = result.findIndex((w) => w.lastName === imported.lastName);\n        if (existingIdx >= 0) {\n          // Merge entries\n          const existingEntryIds = new Set(result[existingIdx].entries.map((e) => e.id));\n          const newEntries = imported.entries.filter((e) => !existingEntryIds.has(e.id));\n          result[existingIdx] = {\n            ...result[existingIdx],\n            entries: [...result[existingIdx].entries, ...newEntries],\n            overtime: { ...imported.overtime, ...result[existingIdx].overtime },\n            overtimeManual: {\n              ...imported.overtimeManual,\n              ...result[existingIdx].overtimeManual,\n            },\n          };\n        } else {\n          result.push(imported);\n        }\n      }\n      return result;\n    });\n  }\n\n  // Recalc plan after import\n  const allWelders = get(welders);\n  planItems.update((plan) => recalcPlanCompleted(plan, allWelders));\n}\n"
    },
    {
      "path": "src/lib/components/BottomNav.svelte",
      "size": 1851,
      "content": "<script lang=\"ts\">\n  import { page } from '$app/stores';\n</script>\n\n<nav class=\"bottom-nav\">\n  <a href=\"/\" class:active={$page.url.pathname === '/'}>\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"22\" height=\"22\">\n      <path d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/>\n    </svg>\n    <span>–ì–ª–∞–≤–Ω–∞—è</span>\n  </a>\n  <a href=\"/rates\" class:active={$page.url.pathname === '/rates'}>\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"22\" height=\"22\">\n      <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l7.59-7.59L21 8l-9 9z\"/>\n    </svg>\n    <span>–ù–æ—Ä–º—ã</span>\n  </a>\n  <a href=\"/plan\" class:active={$page.url.pathname === '/plan'}>\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"22\" height=\"22\">\n      <path d=\"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z\"/>\n    </svg>\n    <span>–ü–ª–∞–Ω</span>\n  </a>\n</nav>\n\n<style>\n  .bottom-nav {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: calc(56px + env(safe-area-inset-bottom));\n    padding-bottom: env(safe-area-inset-bottom);\n    background: #1e293b;\n    border-top: 1px solid #334155;\n    display: flex;\n    align-items: stretch;\n    z-index: 100;\n  }\n\n  .bottom-nav a {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 2px;\n    color: #94a3b8;\n    text-decoration: none;\n    font-size: 11px;\n    transition: color 0.15s;\n  }\n\n  .bottom-nav a.active {\n    color: #38bdf8;\n  }\n\n  .bottom-nav a:active {\n    opacity: 0.7;\n  }\n</style>\n"
    },
    {
      "path": "src/routes/+layout.svelte",
      "size": 62,
      "content": "<script lang=\"ts\">\n  import '../app.css';\n</script>\n\n<slot />\n"
    },
    {
      "path": "src/routes/+layout.ts",
      "size": 26,
      "content": "export const ssr = false;\n"
    },
    {
      "path": "src/routes/+page.svelte",
      "size": 6273,
      "content": "<script lang=\"ts\">\n  import { goto } from '$app/navigation';\n  import { welders, rates, planItems, exportData, importData } from '$lib/stores';\n  import BottomNav from '$lib/components/BottomNav.svelte';\n  import { capitalizeFirst, todayISO, formatQty } from '$lib/utils';\n  import { v4 as uuidv4 } from 'uuid';\n  import type { Welder } from '$lib/types';\n\n  let newLastName = '';\n  let showInfoModal = false;\n  let infoModalWelder: Welder | null = null;\n  let showDeleteModal = false;\n  let deleteTargetId = '';\n  let longPressTimer: ReturnType<typeof setTimeout> | null = null;\n\n  function addWelder() {\n    const name = capitalizeFirst(newLastName);\n    if (!name) return;\n    welders.update((list) => [\n      ...list,\n      { id: uuidv4(), lastName: name, entries: [], overtime: {}, overtimeManual: {} },\n    ]);\n    newLastName = '';\n  }\n\n  function handleKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') addWelder();\n  }\n\n  function openInfo(welder: Welder) {\n    infoModalWelder = welder;\n    showInfoModal = true;\n  }\n\n  function startLongPress(welderId: string) {\n    longPressTimer = setTimeout(() => {\n      deleteTargetId = welderId;\n      showDeleteModal = true;\n    }, 500);\n  }\n\n  function cancelLongPress() {\n    if (longPressTimer) clearTimeout(longPressTimer);\n  }\n\n  function confirmDelete() {\n    welders.update((list) => list.filter((w) => w.id !== deleteTargetId));\n    showDeleteModal = false;\n    deleteTargetId = '';\n  }\n\n  function handleExport() {\n    const json = exportData();\n    const blob = new Blob([json], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `weldtrack-export-${todayISO()}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  function handleImport() {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json,application/json';\n    input.onchange = async () => {\n      const file = input.files?.[0];\n      if (!file) return;\n      const text = await file.text();\n      try {\n        importData(text);\n        alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.');\n      } catch (e) {\n        alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON.');\n      }\n    };\n    input.click();\n  }\n\n  function todaySummary(welder: Welder): string {\n    const today = todayISO();\n    const todayEntries = welder.entries.filter((e) => e.date === today);\n    if (!todayEntries.length) return '';\n    return todayEntries\n      .sort((a, b) => b.updatedAt - a.updatedAt)\n      .map((e) => `${e.article} ${formatQty(e.quantity)} —à—Ç`)\n      .join('; ');\n  }\n\n  function allTimeSummary(welder: Welder): string {\n    const map = new Map<string, number>();\n    for (const e of welder.entries) {\n      map.set(e.article, (map.get(e.article) ?? 0) + e.quantity);\n    }\n    // –ò–∑–º–µ–Ω–µ–Ω–æ: join('\\n') –≤–º–µ—Å—Ç–æ join('; ')\n    return [...map.entries()].map(([art, qty]) => `${art} ${formatQty(qty)} —à—Ç`).join('\\n');\n  }\n</script>\n\n<div class=\"page-container\">\n  <div class=\"top-panel\">\n    <div style=\"display:flex; gap:8px; align-items:center;\">\n      <input\n        type=\"text\"\n        bind:value={newLastName}\n        placeholder=\"–§–∞–º–∏–ª–∏—è —Å–≤–∞—Ä—â–∏–∫–∞\"\n        on:keydown={handleKeydown}\n        autocomplete=\"off\"\n        style=\"flex:1;\"\n      />\n      <button class=\"btn-primary\" on:click={addWelder}>–î–æ–±–∞–≤–∏—Ç—å</button>\n      <button class=\"btn-secondary\" style=\"padding:0 10px;min-width:40px;\" on:click={handleImport} title=\"–ò–º–ø–æ—Ä—Ç\">\n        ‚Üë\n      </button>\n      <button class=\"btn-secondary\" style=\"padding:0 10px;min-width:40px;\" on:click={handleExport} title=\"–≠–∫—Å–ø–æ—Ä—Ç\">\n        ‚Üì\n      </button>\n    </div>\n  </div>\n\n  <div class=\"scroll-area\">\n    {#if $welders.length === 0}\n      <div class=\"empty-state\">\n        <div style=\"font-size:40px;margin-bottom:12px;\">üë∑</div>\n        <div>–ù–µ—Ç —Å–≤–∞—Ä—â–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ.</div>\n      </div>\n    {:else}\n      {#each $welders as welder (welder.id)}\n        {@const summary = todaySummary(welder)}\n        <div\n          class=\"list-item\"\n          style=\"gap:10px;\"\n          on:touchstart={() => startLongPress(welder.id)}\n          on:touchend={cancelLongPress}\n          on:touchcancel={cancelLongPress}\n          on:mousedown={() => startLongPress(welder.id)}\n          on:mouseup={cancelLongPress}\n          on:mouseleave={cancelLongPress}\n          on:click={() => goto(`/wc/${welder.id}`)}\n        >\n          <span style=\"font-weight:700;font-size:17px;min-width:100px;\">{welder.lastName}</span>\n          <span style=\"flex:1;font-size:13px;color:#94a3b8;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;\">\n            {summary}\n          </span>\n          <button\n            class=\"btn-secondary\"\n            style=\"min-height:36px;padding:0 10px;font-size:16px;flex-shrink:0;\"\n            on:click|stopPropagation={() => openInfo(welder)}\n          >‚Ñπ</button>\n        </div>\n      {/each}\n    {/if}\n  </div>\n\n  <BottomNav />\n</div>\n\n<!-- Info Modal -->\n{#if showInfoModal && infoModalWelder}\n  <div class=\"modal-overlay\" on:click={() => (showInfoModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 16px;font-size:18px;\">{infoModalWelder.lastName} ‚Äî –∏—Ç–æ–≥–æ</h3>\n      <!-- –ò–∑–º–µ–Ω–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω white-space:pre-line -->\n      <p style=\"color:#cbd5e1;font-size:15px;line-height:1.7;margin:0;white-space:pre-line;\">\n        {allTimeSummary(infoModalWelder) || '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.'}\n      </p>\n      <button class=\"btn-secondary\" style=\"width:100%;margin-top:20px;\" on:click={() => (showInfoModal = false)}>\n        –ó–∞–∫—Ä—ã—Ç—å\n      </button>\n    </div>\n  </div>\n{/if}\n\n<!-- Delete Confirm Modal -->\n{#if showDeleteModal}\n  <div class=\"modal-overlay\" on:click={() => (showDeleteModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 12px;font-size:18px;\">–£–¥–∞–ª–∏—Ç—å —Å–≤–∞—Ä—â–∏–∫–∞?</h3>\n      <p style=\"color:#94a3b8;margin:0 0 20px;\">–í—Å–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.</p>\n      <div style=\"display:flex;gap:10px;\">\n        <button class=\"btn-secondary\" style=\"flex:1;\" on:click={() => (showDeleteModal = false)}>–û—Ç–º–µ–Ω–∞</button>\n        <button class=\"btn-danger\" style=\"flex:1;\" on:click={confirmDelete}>–£–¥–∞–ª–∏—Ç—å</button>\n      </div>\n    </div>\n  </div>\n{/if}"
    },
    {
      "path": "src/routes/rates/+page.svelte",
      "size": 5729,
      "content": "<script lang=\"ts\">\n  import { rates } from '$lib/stores';\n  import BottomNav from '$lib/components/BottomNav.svelte';\n  import { normalizeArticle, formatQty } from '$lib/utils';\n  import { v4 as uuidv4 } from 'uuid';\n  import type { Rate } from '$lib/types';\n\n  let articleInput = '';\n  let normInput = '';\n  let showSuggestions = false;\n  let editModal = false;\n  let editTarget: Rate | null = null;\n  let editArticle = '';\n  let editNorm = '';\n  let longPressTimer: ReturnType<typeof setTimeout> | null = null;\n  let longPressId = '';\n\n  $: sortedRates = [...$rates].sort((a, b) => a.article.localeCompare(b.article, undefined, { numeric: true }));\n\n  $: suggestions = articleInput\n    ? $rates\n        .map((r) => r.article)\n        .filter((a) => a.includes(normalizeArticle(articleInput)) && a !== normalizeArticle(articleInput))\n        .slice(0, 5)\n    : [];\n\n  function addRate() {\n    const article = normalizeArticle(articleInput);\n    const norm = parseFloat(normInput);\n    if (!article || isNaN(norm) || norm <= 0) return;\n    rates.update((list) => {\n      const existing = list.findIndex((r) => r.article === article);\n      if (existing >= 0) {\n        // Update existing, move to top\n        const updated = { ...list[existing], norm };\n        const rest = list.filter((_, i) => i !== existing);\n        return [updated, ...rest];\n      }\n      return [{ id: uuidv4(), article, norm }, ...list];\n    });\n    articleInput = '';\n    normInput = '';\n    showSuggestions = false;\n  }\n\n  function selectSuggestion(s: string) {\n    articleInput = s;\n    showSuggestions = false;\n  }\n\n  function startLongPress(rate: Rate) {\n    longPressId = rate.id;\n    longPressTimer = setTimeout(() => {\n      editTarget = rate;\n      editArticle = rate.article;\n      editNorm = String(rate.norm);\n      editModal = true;\n    }, 500);\n  }\n\n  function cancelLongPress() {\n    if (longPressTimer) clearTimeout(longPressTimer);\n  }\n\n  function saveEdit() {\n    if (!editTarget) return;\n    const article = normalizeArticle(editArticle);\n    const norm = parseFloat(editNorm);\n    if (!article || isNaN(norm) || norm <= 0) return;\n    rates.update((list) => {\n      const filtered = list.filter((r) => r.id !== editTarget!.id);\n      return [{ ...editTarget!, article, norm }, ...filtered];\n    });\n    editModal = false;\n    editTarget = null;\n  }\n\n  function deleteRate() {\n    if (!editTarget) return;\n    rates.update((list) => list.filter((r) => r.id !== editTarget!.id));\n    editModal = false;\n    editTarget = null;\n  }\n\n  function handleKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') addRate();\n  }\n</script>\n\n<div class=\"page-container\">\n  <div class=\"top-panel\">\n    <div style=\"display:flex;gap:8px;align-items:center;\">\n      <div style=\"position:relative;flex:1;\">\n        <input\n          type=\"text\"\n          bind:value={articleInput}\n          placeholder=\"–ê—Ä—Ç–∏–∫—É–ª\"\n          on:input={() => (showSuggestions = true)}\n          on:focus={() => (showSuggestions = true)}\n          on:blur={() => setTimeout(() => (showSuggestions = false), 150)}\n          on:keydown={handleKeydown}\n          autocomplete=\"off\"\n          style=\"text-transform:uppercase;\"\n        />\n        {#if showSuggestions && suggestions.length > 0}\n          <div class=\"suggestions\">\n            {#each suggestions as s}\n              <div class=\"suggestion-item\" on:mousedown={() => selectSuggestion(s)}>{s}</div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n      <input\n        type=\"number\"\n        bind:value={normInput}\n        placeholder=\"–ù–æ—Ä–º–∞ (—á)\"\n        inputmode=\"decimal\"\n        on:keydown={handleKeydown}\n        autocomplete=\"off\"\n        style=\"width:110px;\"\n      />\n      <button class=\"btn-primary\" on:click={addRate}>–î–æ–±–∞–≤–∏—Ç—å</button>\n    </div>\n  </div>\n\n  <div class=\"scroll-area\">\n    {#if sortedRates.length === 0}\n      <div class=\"empty-state\">\n        <div style=\"font-size:40px;margin-bottom:12px;\">üìã</div>\n        <div>–ù–µ—Ç –Ω–æ—Ä–º. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é.</div>\n      </div>\n    {:else}\n      {#each sortedRates as rate (rate.id)}\n        <div\n          class=\"list-item\"\n          on:touchstart={() => startLongPress(rate)}\n          on:touchend={cancelLongPress}\n          on:touchcancel={cancelLongPress}\n          on:mousedown={() => startLongPress(rate)}\n          on:mouseup={cancelLongPress}\n          on:mouseleave={cancelLongPress}\n        >\n          <span style=\"flex:1;font-weight:700;font-size:16px;\">{rate.article}</span>\n          <span style=\"color:#94a3b8;font-size:15px;\">{formatQty(rate.norm)} —á</span>\n        </div>\n      {/each}\n    {/if}\n  </div>\n\n  <BottomNav />\n</div>\n\n<!-- Edit/Delete Modal -->\n{#if editModal && editTarget}\n  <div class=\"modal-overlay\" on:click={() => (editModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 16px;font-size:18px;\">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ—Ä–º—É</h3>\n      <div style=\"display:flex;gap:8px;margin-bottom:16px;\">\n        <input\n          type=\"text\"\n          bind:value={editArticle}\n          placeholder=\"–ê—Ä—Ç–∏–∫—É–ª\"\n          autocomplete=\"off\"\n          style=\"flex:1;text-transform:uppercase;\"\n        />\n        <input\n          type=\"number\"\n          bind:value={editNorm}\n          placeholder=\"–ù–æ—Ä–º–∞ (—á)\"\n          inputmode=\"decimal\"\n          autocomplete=\"off\"\n          style=\"width:110px;\"\n        />\n      </div>\n      <div style=\"display:flex;gap:8px;\">\n        <button class=\"btn-danger\" style=\"flex:1;\" on:click={deleteRate}>–£–¥–∞–ª–∏—Ç—å</button>\n        <button class=\"btn-secondary\" style=\"flex:1;\" on:click={() => (editModal = false)}>–û—Ç–º–µ–Ω–∞</button>\n        <button class=\"btn-primary\" style=\"flex:1;\" on:click={saveEdit}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\n      </div>\n    </div>\n  </div>\n{/if}\n"
    },
    {
      "path": "src/routes/wc/[id]/+page.ts",
      "size": 0,
      "content": ""
    },
    {
      "path": "src/routes/wc/[id]/+page.svelte",
      "size": 15101,
      "content": "<script lang=\"ts\">\n  import { page } from '$app/stores';\n  import { goto } from '$app/navigation';\n  import { welders, rates, planItems } from '$lib/stores';\n  import BottomNav from '$lib/components/BottomNav.svelte';\n  import { normalizeArticle, formatQty, calcOvertime, calcDayHours, calcDayStats, recalcPlanCompleted, todayISO } from '$lib/utils';\n  import { v4 as uuidv4 } from 'uuid';\n  import { get } from 'svelte/store';\n  import type { WCEntry } from '$lib/types';\n\n  $: welderId = $page.params.id;\n  $: welder = $welders.find((w) => w.id === welderId);\n\n  let articleInput = '';\n  let quantityInput = '';\n  let stage: 'article' | 'quantity' = 'article';\n  let showSuggestions = false;\n  let confirmedArticle = '';\n\n  let editingOvertime = false;\n  let overtimeInput = '';\n\n  let editModal = false;\n  let editEntry: WCEntry | null = null;\n  let editQtyInput = '';\n  let longPressTimer: ReturnType<typeof setTimeout> | null = null;\n\n  $: today = todayISO();\n\n  $: availableArticles = $planItems\n    .filter((p) => !p.locked)\n    .map((p) => p.article);\n\n  $: suggestions = articleInput\n    ? availableArticles.filter((a) =>\n        a.includes(normalizeArticle(articleInput))\n      ).slice(0, 5)\n    : availableArticles.slice(0, 5);\n\n  // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–µ–π –ø–æ –¥–∞—Ç–∞–º, –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É\n  $: groupedByDate = (() => {\n    if (!welder) return [];\n    const dateMap = new Map<string, WCEntry[]>();\n    for (const entry of welder.entries) {\n      if (!dateMap.has(entry.date)) dateMap.set(entry.date, []);\n      dateMap.get(entry.date)!.push(entry);\n    }\n    const sortedDates = [...dateMap.keys()].sort((a, b) => b.localeCompare(a));\n    return sortedDates.map((date) => ({\n      date,\n      entries: dateMap.get(date)!.sort((a, b) => b.updatedAt - a.updatedAt),\n    }));\n  })();\n\n  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º —Å —É—á—ë—Ç–æ–º –ø—É–ª–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ (–¥–∞—Ç—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—á—ë—Ç–∞)\n  $: dayStats = (() => {\n    if (!welder) return new Map();\n    const allDates = [...new Set(welder.entries.map((e) => e.date))].sort();\n    return calcDayStats(welder.entries, $rates, welder.overtime ?? {}, allDates);\n  })();\n\n  $: todayOvertime = welder?.overtime?.[today] ?? 0;\n\n  $: infoPlan = confirmedArticle\n    ? $planItems.find((p) => p.article === confirmedArticle)\n    : null;\n\n  $: infoWelderData = confirmedArticle\n    ? $welders\n        .filter((w) => w.entries.some((e) => e.article === confirmedArticle))\n        .map((w) => ({\n          name: w.lastName,\n          qty: w.entries\n            .filter((e) => e.article === confirmedArticle)\n            .reduce((sum, e) => sum + e.quantity, 0),\n        }))\n    : [];\n\n  function selectArticle(article: string) {\n    const plan = $planItems.find((p) => p.article === article);\n    if (plan?.locked) {\n      alert('–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.');\n      return;\n    }\n    confirmedArticle = article;\n    articleInput = article;\n    showSuggestions = false;\n    stage = 'quantity';\n    quantityInput = '';\n  }\n\n  function submitEntry() {\n    if (!welder || !confirmedArticle) return;\n    const qty = parseFloat(quantityInput);\n    if (isNaN(qty) || qty <= 0) return;\n\n    const plan = $planItems.find((p) => p.article === confirmedArticle);\n    if (plan?.locked) {\n      alert('–ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.');\n      return;\n    }\n\n    welders.update((list) => {\n      return list.map((w) => {\n        if (w.id !== welderId) return w;\n\n        const existingIdx = w.entries.findIndex(\n          (e) => e.article === confirmedArticle && e.date === today\n        );\n        let newEntries: WCEntry[];\n\n        if (existingIdx >= 0) {\n          newEntries = w.entries.map((e, i) =>\n            i === existingIdx\n              ? { ...e, quantity: e.quantity + qty, updatedAt: Date.now() }\n              : e\n          );\n        } else {\n          newEntries = [\n            ...w.entries,\n            {\n              id: uuidv4(),\n              article: confirmedArticle,\n              quantity: qty,\n              date: today,\n              updatedAt: Date.now(),\n            },\n          ];\n        }\n\n        const newOvertime = { ...w.overtime };\n        newOvertime[today] = calcOvertime(newEntries, get(rates), today);\n\n        return { ...w, entries: newEntries, overtime: newOvertime };\n      });\n    });\n\n    planItems.update((plan) => recalcPlanCompleted(plan, get(welders)));\n\n    stage = 'article';\n    articleInput = '';\n    quantityInput = '';\n    confirmedArticle = '';\n  }\n\n  function handleArticleKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      const norm = normalizeArticle(articleInput);\n      if (norm) selectArticle(norm);\n    }\n    if (e.key === 'Escape') resetInput();\n  }\n\n  function handleQtyKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') submitEntry();\n    if (e.key === 'Escape') resetInput();\n  }\n\n  function resetInput() {\n    stage = 'article';\n    articleInput = '';\n    quantityInput = '';\n    confirmedArticle = '';\n    showSuggestions = false;\n  }\n\n  function tapEntry(entry: WCEntry) {\n    selectArticle(entry.article);\n  }\n\n  function startLongPress(entry: WCEntry) {\n    longPressTimer = setTimeout(() => {\n      editEntry = entry;\n      editQtyInput = String(entry.quantity);\n      editModal = true;\n    }, 500);\n  }\n\n  function cancelLongPress() {\n    if (longPressTimer) clearTimeout(longPressTimer);\n  }\n\n  function saveEntryEdit() {\n    if (!editEntry || !welder) return;\n    const newQty = parseFloat(editQtyInput);\n    if (isNaN(newQty) || newQty <= 0) return;\n\n    const editDate = editEntry.date;\n\n    welders.update((list) =>\n      list.map((w) => {\n        if (w.id !== welderId) return w;\n\n        const newEntries = w.entries.map((e) =>\n          e.id === editEntry!.id\n            ? { ...e, quantity: newQty, updatedAt: Date.now() }\n            : e\n        );\n\n        const newOvertime = { ...w.overtime };\n        newOvertime[editDate] = calcOvertime(newEntries, get(rates), editDate);\n\n        return { ...w, entries: newEntries, overtime: newOvertime };\n      })\n    );\n    planItems.update((plan) => recalcPlanCompleted(plan, get(welders)));\n    editModal = false;\n    editEntry = null;\n  }\n\n  function deleteEntry() {\n    if (!editEntry || !welder) return;\n    const entryDate = editEntry.date;\n\n    welders.update((list) =>\n      list.map((w) => {\n        if (w.id !== welderId) return w;\n\n        const newEntries = w.entries.filter((e) => e.id !== editEntry!.id);\n\n        const newOvertime = { ...w.overtime };\n        newOvertime[entryDate] = calcOvertime(newEntries, get(rates), entryDate);\n\n        return { ...w, entries: newEntries, overtime: newOvertime };\n      })\n    );\n\n    planItems.update((plan) => recalcPlanCompleted(plan, get(welders)));\n    editModal = false;\n    editEntry = null;\n  }\n\n  // –†—É—á–Ω–∞—è –ø—Ä–∞–≤–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è\n  function startOvertimeEdit() {\n    editingOvertime = true;\n    overtimeInput = String(todayOvertime);\n  }\n\n  function saveOvertimeEdit() {\n    const val = parseFloat(overtimeInput);\n    if (isNaN(val) || val < 0) {\n      editingOvertime = false;\n      return;\n    }\n    welders.update((list) =>\n      list.map((w) => {\n        if (w.id !== welderId) return w;\n        return {\n          ...w,\n          overtime: { ...w.overtime, [today]: val },\n        };\n      })\n    );\n    editingOvertime = false;\n  }\n\n  function handleOvertimeKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') saveOvertimeEdit();\n    if (e.key === 'Escape') editingOvertime = false;\n  }\n\n  function formatDateLabel(dateISO: string): string {\n    if (dateISO === today) return '–°–µ–≥–æ–¥–Ω—è';\n    const [y, m, d] = dateISO.split('-');\n    return `${d}.${m}.${y}`;\n  }\n</script>\n\n<div class=\"page-container\">\n  <!-- Top bar -->\n  <div class=\"top-panel\" style=\"display:flex;align-items:center;gap:10px;\">\n    <button\n      class=\"btn-secondary\"\n      style=\"min-height:36px;padding:0 12px;font-size:20px;\"\n      on:click={() => goto('/')}\n    >‚Üê</button>\n    <span style=\"font-weight:700;font-size:18px;flex:1;\">{welder?.lastName ?? '...'}</span>\n  </div>\n\n  <!-- Input area -->\n  <div style=\"background:#1e293b;border-bottom:1px solid #334155;padding:10px 12px;\">\n    {#if stage === 'article'}\n      <div style=\"position:relative;\">\n        <input\n          type=\"text\"\n          bind:value={articleInput}\n          placeholder=\"–í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª\"\n          on:input={() => (showSuggestions = true)}\n          on:focus={() => (showSuggestions = true)}\n          on:blur={() => setTimeout(() => (showSuggestions = false), 150)}\n          on:keydown={handleArticleKeydown}\n          autocomplete=\"off\"\n          style=\"text-transform:uppercase;\"\n        />\n        {#if showSuggestions && suggestions.length > 0}\n          <div class=\"suggestions\">\n            {#each suggestions as s}\n              {@const plan = $planItems.find((p) => p.article === s)}\n              <div\n                class=\"suggestion-item\"\n                style={plan?.locked ? 'opacity:0.5;text-decoration:line-through;' : ''}\n                on:mousedown={() => selectArticle(s)}\n              >\n                {s}\n                {#if plan?.locked}<span style=\"font-size:12px;color:#f87171;\"> (–ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω)</span>{/if}\n              </div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n    {:else}\n      <div style=\"margin-bottom:8px;padding:10px;background:#0f172a;border-radius:8px;font-size:13px;color:#94a3b8;\">\n        {#if infoPlan}\n          <strong style=\"color:#38bdf8;font-size:15px;\">{confirmedArticle}</strong>\n          ‚Äî –ø–ª–∞–Ω: {formatQty(infoPlan.target)} —à—Ç\n          {#if infoWelderData.length > 0}\n            <span style=\"margin-left:6px;\">|</span>\n            {#each infoWelderData as wd}\n              <span style=\"margin-left:6px;\">{wd.name}: {formatQty(wd.qty)}</span>\n            {/each}\n          {/if}\n        {:else}\n          <strong style=\"color:#38bdf8;\">{confirmedArticle}</strong>\n        {/if}\n      </div>\n      <div style=\"display:flex;gap:8px;align-items:center;\">\n        <button class=\"btn-secondary\" style=\"min-height:40px;padding:0 10px;\" on:click={resetInput}>‚úï</button>\n        <input\n          type=\"number\"\n          bind:value={quantityInput}\n          placeholder=\"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)\"\n          inputmode=\"decimal\"\n          on:keydown={handleQtyKeydown}\n          autocomplete=\"off\"\n          style=\"flex:1;\"\n        />\n        <button class=\"btn-primary\" on:click={submitEntry}>–î–æ–±–∞–≤–∏—Ç—å</button>\n      </div>\n    {/if}\n  </div>\n\n  <!-- Entries list grouped by date + overtime overlay -->\n  <div style=\"position:relative;flex:1;overflow:hidden;\">\n    <div class=\"scroll-area\" style=\"padding-right:90px;\">\n      {#if groupedByDate.length === 0}\n        <div class=\"empty-state\">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é.</div>\n      {:else}\n        {#each groupedByDate as group (group.date)}\n          {@const stats = dayStats.get(group.date)}\n          {@const normalH = stats?.normalHours ?? 0}\n          {@const overH = stats?.overtimeHours ?? 0}\n\n          <!-- Day block header with underline -->\n          <div style=\"\n            display:flex;\n            align-items:center;\n            justify-content:space-between;\n            padding:8px 12px 6px;\n            margin-top:10px;\n            border-bottom:2px solid #334155;\n            background:#0f172a;\n            position:sticky;\n            top:0;\n            z-index:10;\n          \">\n            <!-- –î–∞—Ç–∞ -->\n            <span style=\"font-size:13px;font-weight:700;color:{group.date === today ? '#38bdf8' : '#64748b'};\">\n              {formatDateLabel(group.date)}\n            </span>\n\n            <!-- –ß–∞—Å—ã -->\n            <div style=\"display:flex;align-items:center;gap:6px;font-size:13px;font-weight:700;\">\n              <!-- –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —á–∞—Å—ã (–∑–µ–ª—ë–Ω—ã–π) -->\n              <span style=\"color:#4ade80;\">{formatQty(normalH)}—á</span>\n\n              {#if overH > 0}\n                <!-- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π) -->\n                <span style=\"color:#94a3b8;font-size:11px;font-weight:400;\">+</span>\n                <span style=\"color:#f59e0b;\">{formatQty(overH)}—á</span>\n              {/if}\n            </div>\n          </div>\n\n          <!-- –ó–∞–ø–∏—Å–∏ –¥–Ω—è -->\n          {#each group.entries as entry (entry.id)}\n            {@const plan = $planItems.find((p) => p.article === entry.article)}\n            <div\n              class=\"list-item\"\n              on:click={() => tapEntry(entry)}\n              on:touchstart={() => startLongPress(entry)}\n              on:touchend={cancelLongPress}\n              on:touchcancel={cancelLongPress}\n              on:mousedown={() => startLongPress(entry)}\n              on:mouseup={cancelLongPress}\n              on:mouseleave={cancelLongPress}\n            >\n              <span\n                style=\"flex:1;font-weight:700;font-size:16px;{plan?.locked ? 'text-decoration:line-through;color:#64748b;' : ''}\"\n              >{entry.article}{plan?.locked ? ' ‚úì' : ''}</span>\n              <span style=\"font-size:15px;\">{formatQty(entry.quantity)} —à—Ç</span>\n            </div>\n          {/each}\n        {/each}\n      {/if}\n    </div>\n\n    <!-- Overtime panel (—Å–µ–≥–æ–¥–Ω—è) ‚Äî —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->\n    <div\n      style=\"\n        position:absolute;\n        top:8px;\n        right:0;\n        width:82px;\n        background:#1e293b;\n        border-radius:10px 0 0 10px;\n        padding:10px 8px;\n        border:1px solid #334155;\n        border-right:none;\n        cursor:pointer;\n        text-align:center;\n      \"\n      on:click={startOvertimeEdit}\n    >\n      <div style=\"font-size:10px;color:#64748b;margin-bottom:4px;\">–ü–µ—Ä–µ—Ä–∞–±.</div>\n      {#if editingOvertime}\n        <input\n          type=\"number\"\n          bind:value={overtimeInput}\n          inputmode=\"decimal\"\n          on:keydown={handleOvertimeKeydown}\n          on:blur={saveOvertimeEdit}\n          autocomplete=\"off\"\n          style=\"width:66px;text-align:center;font-size:14px;padding:4px;\"\n          on:click|stopPropagation\n        />\n      {:else}\n        <div\n          style=\"font-size:16px;font-weight:700;color:{todayOvertime > 0 ? '#f59e0b' : '#64748b'};\"\n        >\n          {formatQty(todayOvertime)}\n        </div>\n        <div style=\"font-size:11px;color:#64748b;\">—á</div>\n      {/if}\n    </div>\n  </div>\n\n  <BottomNav />\n</div>\n\n<!-- Entry Edit Modal -->\n{#if editModal && editEntry}\n  <div class=\"modal-overlay\" on:click={() => (editModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 4px;font-size:18px;\">–ó–∞–ø–∏—Å—å: {editEntry.article}</h3>\n      <p style=\"margin:0 0 16px;color:#64748b;font-size:13px;\">{editEntry.date}</p>\n      <input\n        type=\"number\"\n        bind:value={editQtyInput}\n        placeholder=\"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)\"\n        inputmode=\"decimal\"\n        autocomplete=\"off\"\n        style=\"margin-bottom:16px;\"\n      />\n      <div style=\"display:flex;gap:8px;\">\n        <button class=\"btn-danger\" style=\"flex:1;\" on:click={deleteEntry}>–£–¥–∞–ª–∏—Ç—å</button>\n        <button class=\"btn-secondary\" style=\"flex:1;\" on:click={() => (editModal = false)}>–û—Ç–º–µ–Ω–∞</button>\n        <button class=\"btn-primary\" style=\"flex:1;\" on:click={saveEntryEdit}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\n      </div>\n    </div>\n  </div>\n{/if}"
    },
    {
      "path": "src/routes/plan/+page.svelte",
      "size": 10868,
      "content": "<script lang=\"ts\">\n  import { rates, planItems, welders } from '$lib/stores';\n  import BottomNav from '$lib/components/BottomNav.svelte';\n  import { normalizeArticle, formatQty, recalcPlanCompleted, todayISO } from '$lib/utils';\n  import { v4 as uuidv4 } from 'uuid';\n  import type { PlanItem } from '$lib/types';\n\n  let articleInput = '';\n  let targetInput = '';\n  let dateInput = todayISO();\n  let showSuggestions = false;\n  let editModal = false;\n  let editTarget: PlanItem | null = null;\n  let editTargetQty = '';\n  let longPressTimer: ReturnType<typeof setTimeout> | null = null;\n\n  // Info modal\n  let showInfoModal = false;\n  let infoItem: PlanItem | null = null;\n  let infoWelders: { name: string; qty: number }[] = [];\n\n  $: rateArticles = $rates.map((r) => r.article);\n\n  // --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–û–î–°–ö–ê–ó–û–ö ---\n  // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞—Ä—Ç–∏–∫—É–ª, –µ—Å–ª–∏:\n  // 1. –û–Ω –µ—Å—Ç—å –≤ –Ω–æ—Ä–º–∞—Ö.\n  // 2. –ù–ï–¢ –ê–ö–¢–ò–í–ù–û–ì–û (–Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ) –ø–ª–∞–Ω–∞ —Å —ç—Ç–∏–º –∞—Ä—Ç–∏–∫—É–ª–æ–º.\n  // (–ï—Å–ª–∏ –ø–ª–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω/locked, —Ç–æ \"–∞–∫—Ç–∏–≤–Ω–æ–≥–æ\" –Ω–µ—Ç -> –∑–Ω–∞—á–∏—Ç –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω)\n  $: suggestions = articleInput\n    ? rateArticles.filter((a) => {\n        const matchesInput = a.includes(normalizeArticle(articleInput));\n        if (!matchesInput) return false;\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ù–ï–ó–ê–í–ï–†–®–ï–ù–ù–´–ô –ø–ª–∞–Ω —Å —ç—Ç–∏–º –∞—Ä—Ç–∏–∫—É–ª–æ–º\n        const hasActivePlan = $planItems.some(\n          (p) => p.article === a && !p.locked\n        );\n\n        // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º (–Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π –ø–æ–≤–µ—Ä—Ö).\n        // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–µ—Ç (—Å—Ç–∞—Ä—ã–π –≤—ã–ø–æ–ª–Ω–µ–Ω –∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª–æ) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º.\n        return !hasActivePlan;\n      }).slice(0, 5)\n    : [];\n\n  function addPlanItem() {\n    const article = normalizeArticle(articleInput);\n    const target = parseFloat(targetInput);\n    const startDate = dateInput || todayISO();\n    if (!article || isNaN(target) || target <= 0) return;\n    if (!rateArticles.includes(article)) {\n      alert(`–ê—Ä—Ç–∏–∫—É–ª ${article} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –Ω–æ—Ä–º–∞—Ö.`);\n      return;\n    }\n\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏\n    const activePlanExists = $planItems.some(p => p.article === article && !p.locked);\n    if (activePlanExists) {\n       alert(`–£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –ø–æ ${article}. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.`);\n       return;\n    }\n\n    planItems.update((list) => [\n      { \n        id: uuidv4(), \n        article, \n        target, \n        completed: 0, \n        locked: false, \n        startDate, \n        completedDate: null \n      },\n      ...list,\n    ]);\n    articleInput = '';\n    targetInput = '';\n    showSuggestions = false;\n  }\n\n  function selectSuggestion(s: string) {\n    articleInput = s;\n    showSuggestions = false;\n  }\n\n  function startLongPress(item: PlanItem) {\n    longPressTimer = setTimeout(() => {\n      editTarget = item;\n      editTargetQty = String(item.target);\n      editModal = true;\n    }, 500);\n  }\n\n  function cancelLongPress() {\n    if (longPressTimer) clearTimeout(longPressTimer);\n  }\n\n  function saveEdit() {\n    if (!editTarget) return;\n    const target = parseFloat(editTargetQty);\n    if (isNaN(target) || target <= 0) return;\n    planItems.update((list) => {\n      const updated = list.map((p) =>\n        p.id === editTarget!.id\n          ? { ...p, target, locked: p.completed >= target, completedDate: p.completed >= target ? (p.completedDate ?? todayISO()) : null }\n          : p\n      );\n      return recalcPlanCompleted(updated, $welders);\n    });\n    editModal = false;\n    editTarget = null;\n  }\n\n  function deletePlan() {\n    if (!editTarget) return;\n    planItems.update((list) => list.filter((p) => p.id !== editTarget!.id));\n    editModal = false;\n    editTarget = null;\n  }\n\n  function handleKeydown(e: KeyboardEvent) {\n    if (e.key === 'Enter') addPlanItem();\n  }\n\n  // --- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–ï–¢–ê–õ–ï–ô ---\n    function openInfo(item: PlanItem) {\n    const stats: { name: string; qty: number }[] = [];\n    \n    const periodStart = item.startDate;\n    const periodEnd = item.completedDate || todayISO();\n\n    // –ï—Å–ª–∏ –º—ã —Å–º–æ—Ç—Ä–∏–º –ù–û–í–´–ô –ø–ª–∞–Ω, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–ª–∏—Å—å –°–¢–ê–†–´–ï,\n    // —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∏ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–ª–∞–Ω–∞.\n    const lockedDates = $planItems\n      .filter(p => p.id !== item.id && p.article === item.article && p.locked && p.completedDate)\n      .map(p => p.completedDate as string);\n\n    for (const w of $welders) {\n      const qty = w.entries\n        .filter((e) => {\n            // –§–∏–ª—å—Ç—Ä –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø–µ—Ä–∏–æ–¥—É\n            if (e.article !== item.article) return false;\n            if (e.date < periodStart || e.date > periodEnd) return false;\n\n            // –ï—Å–ª–∏ –ø–ª–∞–Ω –ê–ö–¢–ò–í–ù–´–ô (–Ω–µ –∑–∞–∫—Ä—ã—Ç), –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –∑–∞–ø–∏—Å—å —Å—Ç–∞—Ä—ã–º –ø–ª–∞–Ω–æ–º\n            if (!item.locked) {\n                const isClaimedByOldPlan = lockedDates.some(lockDate => e.date <= lockDate);\n                if (isClaimedByOldPlan) return false;\n            }\n            \n            return true;\n        })\n        .reduce((sum, e) => sum + e.quantity, 0);\n        \n      if (qty > 0) {\n        stats.push({ name: w.lastName, qty });\n      }\n    }\n    \n    infoWelders = stats.sort((a, b) => b.qty - a.qty);\n    infoItem = item;\n    showInfoModal = true;\n  }\n</script>\n\n<div class=\"page-container\">\n  <div class=\"top-panel\">\n    <div style=\"display:flex;gap:8px;align-items:center;\">\n      <div style=\"position:relative;flex:1;\">\n        <input\n          type=\"text\"\n          bind:value={articleInput}\n          placeholder=\"–ê—Ä—Ç–∏–∫—É–ª\"\n          on:input={() => (showSuggestions = true)}\n          on:focus={() => (showSuggestions = true)}\n          on:blur={() => setTimeout(() => (showSuggestions = false), 150)}\n          on:keydown={handleKeydown}\n          autocomplete=\"off\"\n          style=\"text-transform:uppercase;\"\n        />\n        {#if showSuggestions && suggestions.length > 0}\n          <div class=\"suggestions\">\n            {#each suggestions as s}\n              <div class=\"suggestion-item\" on:mousedown={() => selectSuggestion(s)}>{s}</div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n      <input\n        type=\"number\"\n        bind:value={targetInput}\n        placeholder=\"–ö–æ–ª-–≤–æ\"\n        inputmode=\"decimal\"\n        on:keydown={handleKeydown}\n        autocomplete=\"off\"\n        style=\"width:80px;\"\n      />\n      <input\n        type=\"date\"\n        bind:value={dateInput}\n        on:keydown={handleKeydown}\n        autocomplete=\"off\"\n        style=\"width:130px;\"\n      />\n      <button class=\"btn-primary\" on:click={addPlanItem}>+</button>\n    </div>\n  </div>\n\n  <div class=\"scroll-area\">\n    {#if $planItems.length === 0}\n      <div class=\"empty-state\">\n        <div style=\"font-size:40px;margin-bottom:12px;\">üìä</div>\n        <div>–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–π –ø–ª–∞–Ω–∞.</div>\n      </div>\n    {:else}\n      {#each $planItems as item (item.id)}\n        <div\n          class=\"list-item\"\n          style={item.locked ? 'background:#14532d;' : ''}\n          on:touchstart={() => startLongPress(item)}\n          on:touchend={cancelLongPress}\n          on:touchcancel={cancelLongPress}\n          on:mousedown={() => startLongPress(item)}\n          on:mouseup={cancelLongPress}\n          on:mouseleave={cancelLongPress}\n        >\n          <div style=\"display:flex;flex-direction:column;gap:2px;flex:1;min-width:0;\">\n            <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-weight:700;font-size:16px;\">{item.article}</span>\n                {#if item.locked}\n                    <span style=\"font-size:10px;background:#166534;padding:2px 6px;border-radius:4px;color:#fff;\">–ó–ê–í–ï–†–®–Å–ù</span>\n                {/if}\n            </div>\n            <span style=\"font-size:11px;color:#94a3b8;white-space:nowrap;\">\n              –°—Ç–∞—Ä—Ç: {item.startDate}\n              {#if item.completedDate}\n                ‚Üí –§–∏–Ω–∏—à: {item.completedDate}\n              {/if}\n            </span>\n          </div>\n          \n          <div style=\"text-align:right;margin-left:8px;flex-shrink:0;\">\n             <div style=\"font-size:15px;\">\n                <span style=\"color:#fbbf24;font-weight:700;\">{formatQty(item.completed)}</span>\n                <span style=\"color:#64748b;\"> / {formatQty(item.target)} —à—Ç</span>\n             </div>\n             <button\n                class=\"btn-secondary\"\n                style=\"min-height:30px;padding:0 8px;font-size:12px;margin-top:4px;\"\n                on:click|stopPropagation={() => openInfo(item)}\n             >–î–µ—Ç–∞–ª–∏</button>\n          </div>\n        </div>\n      {/each}\n    {/if}\n  </div>\n\n  <BottomNav />\n</div>\n\n<!-- Edit/Delete Modal -->\n{#if editModal && editTarget}\n  <div class=\"modal-overlay\" on:click={() => (editModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 4px;font-size:18px;\">\n        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: {editTarget.article}\n      </h3>\n      <p style=\"margin:0 0 16px;color:#64748b;font-size:13px;\">\n        –ü–µ—Ä–∏–æ–¥: {editTarget.startDate} ‚Äî {editTarget.completedDate || '—Å–µ–π—á–∞—Å'}\n      </p>\n      <input\n        type=\"number\"\n        bind:value={editTargetQty}\n        placeholder=\"–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ\"\n        inputmode=\"decimal\"\n        autocomplete=\"off\"\n        style=\"margin-bottom:16px;\"\n      />\n      <div style=\"display:flex;gap:8px;\">\n        <button class=\"btn-danger\" style=\"flex:1;\" on:click={deletePlan}>–£–¥–∞–ª–∏—Ç—å</button>\n        <button class=\"btn-secondary\" style=\"flex:1;\" on:click={() => (editModal = false)}>–û—Ç–º–µ–Ω–∞</button>\n        <button class=\"btn-primary\" style=\"flex:1;\" on:click={saveEdit}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\n      </div>\n    </div>\n  </div>\n{/if}\n\n<!-- Info Modal -->\n{#if showInfoModal && infoItem}\n  <div class=\"modal-overlay\" on:click={() => (showInfoModal = false)}>\n    <div class=\"modal-sheet\" on:click|stopPropagation>\n      <h3 style=\"margin:0 0 4px;font-size:18px;\">{infoItem.article}</h3>\n      <p style=\"margin:0 0 16px;color:#64748b;font-size:13px;\">\n        –ü–µ—Ä–∏–æ–¥: {infoItem.startDate} ‚Äî {infoItem.completedDate || '—Å–µ–π—á–∞—Å'}\n      </p>\n      \n      {#if infoWelders.length === 0}\n        <p style=\"color:#94a3b8;text-align:center;padding:20px;\">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥</p>\n      {:else}\n        <div style=\"max-height:300px;overflow-y:auto;\">\n          {#each infoWelders as w}\n            <div style=\"display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #334155;\">\n              <span style=\"font-weight:600;\">{w.name}</span>\n              <span style=\"color:#38bdf8;\">{formatQty(w.qty)} —à—Ç</span>\n            </div>\n          {/each}\n        </div>\n        <div style=\"margin-top:12px;padding-top:12px;border-top:2px solid #38bdf8;display:flex;justify-content:space-between;font-weight:700;\">\n          <span>–í—Å–µ–≥–æ —Å–≤–∞—Ä—â–∏–∫–æ–≤: {infoWelders.length}</span>\n          <span>{formatQty(infoItem.completed)} —à—Ç</span>\n        </div>\n      {/if}\n      \n      <button class=\"btn-secondary\" style=\"width:100%;margin-top:20px;\" on:click={() => (showInfoModal = false)}>\n        –ó–∞–∫—Ä—ã—Ç—å\n      </button>\n    </div>\n  </div>\n{/if}"
    }
  ]
}